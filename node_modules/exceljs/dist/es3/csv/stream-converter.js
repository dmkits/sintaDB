/*! ExcelJS 28-04-2017 */
"use strict";var jconv,StreamConverter=module.exports=function(a,b){this.inner=a,b=b||{},this.innerEncoding=(b.innerEncoding||"UTF8").toUpperCase(),this.outerEncoding=(b.outerEncoding||"UTF8").toUpperCase(),this.innerBOM=b.innerBOM||null,this.outerBOM=b.outerBOM||null,this.writeStarted=!1};StreamConverter.prototype.convertInwards=function(a){return a&&("string"==typeof a&&(a=new Buffer(a,this.outerEncoding)),this.innerEncoding!==this.outerEncoding&&(a=jconv.convert(a,this.outerEncoding,this.innerEncoding))),a},StreamConverter.prototype.convertOutwards=function(a){return"string"==typeof a&&(a=new Buffer(a,this.innerEncoding)),this.innerEncoding!==this.outerEncoding&&(a=jconv.convert(a,this.innerEncoding,this.outerEncoding)),a},StreamConverter.prototype.addListener=function(a,b){this.inner.addListener(a,b)},StreamConverter.prototype.removeListener=function(a,b){this.inner.removeListener(a,b)},StreamConverter.prototype.write=function(a,b,c){if(b instanceof Function&&(c=b,b=void 0),!this.writeStarted){if(this.innerBOM&&this.inner.write(this.innerBOM),this.outerBOM){if(a.length<=this.outerBOM.length)return void(c&&c());var d=new Buffer(a.length-this.outerBOM.length);a.copy(d,0,this.outerBOM.length,a.length),a=d}this.writeStarted=!0}this.inner.write(this.convertInwards(a),b?this.innerEncoding:void 0,c)},StreamConverter.prototype.read=function(){},StreamConverter.prototype.pipe=function(a,b){var c=new StreamConverter(a,{innerEncoding:this.outerEncoding,outerEncoding:this.innerEncoding,innerBOM:this.outerBOM,outerBOM:this.innerBOM});this.inner.pipe(c,b)},StreamConverter.prototype.close=function(){this.inner.close()},StreamConverter.prototype.on=function(a,b){var c=this;switch(a){case"data":return this.inner.on("data",function(a){b(c.convertOutwards(a))}),this;default:return this.inner.on(a,b),this}},StreamConverter.prototype.once=function(a,b){this.inner.once(a,b)},StreamConverter.prototype.end=function(a,b,c){this.inner.end(this.convertInwards(a),this.innerEncoding,c)},StreamConverter.prototype.emit=function(a,b){this.inner.emit(a,b)};