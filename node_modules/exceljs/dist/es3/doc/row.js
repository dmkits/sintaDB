/*! ExcelJS 28-04-2017 */
"use strict";var _=require("../utils/under-dash"),Enums=require("./enums"),colCache=require("./../utils/col-cache"),Cell=require("./cell");(module.exports=function(a,b){this._worksheet=a,this._number=b,this._cells=[],this.style={},this.outlineLevel=0}).prototype={get number(){return this._number},get worksheet(){return this._worksheet},commit:function(){this._worksheet._commitRow(this)},destroy:function(){delete this._worksheet,delete this._cells,delete this.style},findCell:function(a){return this._cells[a-1]},_getCell:function(a){var b=this._cells[a.col-1];return b||(b=new Cell(this,this._worksheet.getColumn(a.col),a.address),this._cells[a.col-1]=b),b},getCell:function(a){if("string"==typeof a){var b=this._worksheet._keys[a];a=b?b.number:colCache.l2n(a)}return this._cells[a-1]||this._getCell({address:colCache.encodeAddress(this._number,a),row:this._number,col:a})},splice:function(a,b){var c,d,e,f=Array.prototype.slice.call(arguments,2),g=a+b,h=f.length-b,i=this._cells.length;if(h<0)for(c=g;c<=i;c++)d=this._cells[c-1],d?(this.getCell(c+h).value=d.value,d.value=null):(e=this._cells[c+h-1],e&&(e.value=null));else if(h>0)for(c=i;c>=g;c--)d=this._cells[c-1],d?this.getCell(c+h).value=d.value:this._cells[c+h-1]=void 0;for(c=0;c<f.length;c++)this.getCell(a+c).value=f[c]},eachCell:function(a,b){if(b||(b=a,a=null),a&&a.includeEmpty)for(var c=this._cells.length,d=1;d<=c;d++)b(this.getCell(d),d);else this._cells.forEach(function(a,c){a&&a.type!==Enums.ValueType.Null&&b(a,c+1)})},get values(){var a=[];return this._cells.forEach(function(b){b&&b.type!==Enums.ValueType.Null&&(a[b.col]=b.value)}),a},set values(a){var b=this;if(this._cells=[],a)if(a instanceof Array){var c=0;a.hasOwnProperty("0")&&(c=1),a.forEach(function(a,d){void 0!==a&&(b._getCell({address:colCache.encodeAddress(b._number,d+c),row:b._number,col:d+c}).value=a)})}else _.each(this._worksheet._keys,function(c,d){void 0!==a[d]&&(b._getCell({address:colCache.encodeAddress(b._number,c.number),row:b._number,col:c.number}).value=a[d])})},get hasValues(){return _.some(this._cells,function(a){return a&&a.type!==Enums.ValueType.Null})},get cellCount(){return this._cells.length},get actualCellCount(){var a=0;return this.eachCell(function(){a++}),a},get dimensions(){var a=0,b=0;return this._cells.forEach(function(c){c&&c.type!==Enums.ValueType.Null&&((!a||a>c.col)&&(a=c.col),b<c.col&&(b=c.col))}),a>0?{min:a,max:b}:null},_applyStyle:function(a,b){return this.style[a]=b,this._cells.forEach(function(c){c&&(c[a]=b)}),b},get numFmt(){return this.style.numFmt},set numFmt(a){this._applyStyle("numFmt",a)},get font(){return this.style.font},set font(a){this._applyStyle("font",a)},get alignment(){return this.style.alignment},set alignment(a){this._applyStyle("alignment",a)},get border(){return this.style.border},set border(a){this._applyStyle("border",a)},get fill(){return this.style.fill},set fill(a){this._applyStyle("fill",a)},get hidden(){return!!this._hidden},set hidden(a){this._hidden=a},get outlineLevel(){return this._outlineLevel||0},set outlineLevel(a){this._outlineLevel=a},get collapsed(){return!!(this._outlineLevel&&this._outlineLevel>=this._worksheet.properties.outlineLevelRow)},get model(){var a=[],b=0,c=0;return this._cells.forEach(function(d){if(d){var e=d.model;e&&((!b||b>d.col)&&(b=d.col),c<d.col&&(c=d.col),a.push(e))}}),this.height||a.length?{cells:a,number:this.number,min:b,max:c,height:this.height,style:this.style,hidden:this.hidden,outlineLevel:this.outlineLevel,collapsed:this.collapsed}:null},set model(a){if(a.number!==this._number)throw new Error("Invalid row number in model");var b=this;this._cells=[],a.cells.forEach(function(a){switch(a.type){case Cell.Types.Merge:break;default:b._getCell(colCache.decodeAddress(a.address)).model=a}}),a.height?this.height=a.height:delete this.height,this.hidden=a.hidden,this.outlineLevel=a.outlineLevel||0,this.style=a.style||{}}};