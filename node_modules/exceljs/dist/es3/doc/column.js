/*! ExcelJS 28-04-2017 */
"use strict";var _=require("../utils/under-dash"),colCache=require("../utils/col-cache"),Column=module.exports=function(a,b,c){this._worksheet=a,this._number=b,c!==!1&&(this.defn=c)};Column.prototype={get number(){return this._number},get worksheet(){return this._worksheet},get letter(){return colCache.n2l(this._number)},get isCustomWidth(){return void 0!==this.width&&8!==this.width},get defn(){return{header:this._header,key:this.key,width:this.width,style:this.style,hidden:this.hidden,outlineLevel:this.outlineLevel}},set defn(a){a?(this.key=a.key,this.width=a.width,this.outlineLevel=a.outlineLevel,a.style?this.style=a.style:this.style={},this.header=a.header,this._hidden=!!a.hidden):(delete this._header,delete this.key,delete this.width,this.style={},this.outlineLevel=0)},get headers(){return this._header&&this._header instanceof Array?this._header:[this._header]},get header(){return this._header},set header(a){if(void 0!==a){var b=this;this._header=a,this.headers.forEach(function(a,c){b._worksheet.getCell(c+1,b.number).value=a})}else this._header=[]},get key(){return this._key},set key(a){this._key&&this._worksheet._keys[this._key]===this&&delete this._worksheet._keys[this._key],this._key=a,a&&(this._worksheet._keys[this._key]=this)},get hidden(){return!!this._hidden},set hidden(a){this._hidden=a},get outlineLevel(){return this._outlineLevel||0},set outlineLevel(a){this._outlineLevel=a},get collapsed(){return!!(this._outlineLevel&&this._outlineLevel>=this._worksheet.properties.outlineLevelCol)},toString:function(){return JSON.stringify({key:this.key,width:this.width,headers:this.headers.length?this.headers:void 0})},equivalentTo:function(a){return this.width===a.width&&this.hidden===a.hidden&&this.outlineLevel===a.outlineLevel&&_.isEqual(this.style,a.style)},get isDefault(){if(this.isCustomWidth)return!1;if(this.hidden)return!1;if(this.outlineLevel)return!1;var a=this.style;return!a||!(a.font||a.numFmt||a.alignment||a.border||a.fill)},get headerCount(){return this.headers.length},eachCell:function(a,b){var c=this.number;b||(b=a,a=null),a&&a.includeEmpty?this._worksheet.eachRow(a,function(a,d){b(a.getCell(c),d)}):this._worksheet.eachRow(function(a,d){var e=a.findCell(c);e&&b(e,d)})},_applyStyle:function(a,b){return this.style[a]=b,this.eachCell(function(c){c[a]=b}),b},get numFmt(){return this.style.numFmt},set numFmt(a){this._applyStyle("numFmt",a)},get font(){return this.style.font},set font(a){this._applyStyle("font",a)},get alignment(){return this.style.alignment},set alignment(a){this._applyStyle("alignment",a)},get border(){return this.style.border},set border(a){this._applyStyle("border",a)},get fill(){return this.style.fill},set fill(a){this._applyStyle("fill",a)}},Column.toModel=function(a){var b=[],c=null;return a&&a.forEach(function(a,d){a.isDefault?c&&(c=null):c&&a.equivalentTo(c)?c.max=d+1:(c={min:d+1,max:d+1,width:a.width,style:a.style,isCustomWidth:a.isCustomWidth,hidden:a.hidden,outlineLevel:a.outlineLevel,collapsed:a.collapsed},b.push(c))}),b.length?b:void 0},Column.fromModel=function(a,b){b=b||[];for(var c=[],d=1,e=0;e<b.length;){for(var f=b[e++];d<f.min;)c.push(new Column(a,d++));for(;d<=f.max;)c.push(new Column(a,d++,f))}return c.length?c:null};