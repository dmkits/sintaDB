/*! ExcelJS 28-04-2017 */
"use strict";var utils=require("../../../utils/utils"),colCache=require("../../../utils/col-cache"),BaseXform=require("../base-xform"),VIEW_STATES={frozen:"frozen",frozenSplit:"frozen",split:"split"},SheetViewXform=module.exports=function(){};utils.inherits(SheetViewXform,BaseXform,{get tag(){return"sheetView"},prepare:function(a){switch(a.state){case"frozen":case"split":break;default:a.state="normal"}},render:function(a,b){a.openNode("sheetView",{workbookViewId:b.workbookViewId||0});var c=function(b,c,d){d&&a.addAttribute(b,c)};c("tabSelected","1",b.tabSelected),c("showRuler","0",b.showRuler===!1),c("showRowColHeaders","0",b.showRowColHeaders===!1),c("showGridLines","0",b.showGridLines===!1),c("zoomScale",b.zoomScale,b.zoomScale),c("zoomScaleNormal",b.zoomScaleNormal,b.zoomScaleNormal),c("view",b.style,b.style);var d,e,f,g;switch(b.state){case"frozen":e=b.xSplit||0,f=b.ySplit||0,d=b.topLeftCell||colCache.getAddress(f+1,e+1).address,g=b.xSplit&&b.ySplit?"bottomRight":b.xSplit?"topRight":"bottomLeft",a.leafNode("pane",{xSplit:b.xSplit||void 0,ySplit:b.ySplit||void 0,topLeftCell:d,activePane:g,state:"frozen"}),a.leafNode("selection",{pane:g,activeCell:b.activeCell,sqref:b.activeCell});break;case"split":"topLeft"===b.activePane&&(b.activePane=void 0),a.leafNode("pane",{xSplit:b.xSplit||void 0,ySplit:b.ySplit||void 0,topLeftCell:b.topLeftCell,activePane:b.activePane}),a.leafNode("selection",{pane:b.activePane,activeCell:b.activeCell,sqref:b.activeCell});break;case"normal":b.activeCell&&a.leafNode("selection",{activeCell:b.activeCell,sqref:b.activeCell})}a.closeNode()},parseOpen:function(a){switch(a.name){case"sheetView":return this.sheetView={workbookViewId:parseInt(a.attributes.workbookViewId,10),tabSelected:"1"===a.attributes.tabSelected,showRuler:!("0"===a.attributes.showRuler),showRowColHeaders:!("0"===a.attributes.showRowColHeaders),showGridLines:!("0"===a.attributes.showGridLines),zoomScale:parseInt(a.attributes.zoomScale||"100",10),zoomScaleNormal:parseInt(a.attributes.zoomScaleNormal||"100",10),style:a.attributes.view},this.pane=void 0,this.selections={},!0;case"pane":return this.pane={xSplit:parseInt(a.attributes.xSplit||"0",10),ySplit:parseInt(a.attributes.ySplit||"0",10),topLeftCell:a.attributes.topLeftCell,activePane:a.attributes.activePane||"topLeft",state:a.attributes.state},!0;case"selection":var b=a.attributes.pane||"topLeft";return this.selections[b]={pane:b,activeCell:a.attributes.activeCell},!0;default:return!1}},parseText:function(){},parseClose:function(a){var b,c;switch(a){case"sheetView":return this.sheetView&&this.pane?(b=this.model={workbookViewId:this.sheetView.workbookViewId,state:VIEW_STATES[this.pane.state]||"split",xSplit:this.pane.xSplit,ySplit:this.pane.ySplit,topLeftCell:this.pane.topLeftCell,showRuler:this.sheetView.showRuler,showRowColHeaders:this.sheetView.showRowColHeaders,showGridLines:this.sheetView.showGridLines,zoomScale:this.sheetView.zoomScale,zoomScaleNormal:this.sheetView.zoomScaleNormal},"split"===this.model.state&&(b.activePane=this.pane.activePane),c=this.selections[this.pane.activePane],c&&c.activeCell&&(b.activeCell=c.activeCell),this.sheetView.style&&(b.style=this.sheetView.style)):(b=this.model={workbookViewId:this.sheetView.workbookViewId,state:"normal",showRuler:this.sheetView.showRuler,showRowColHeaders:this.sheetView.showRowColHeaders,showGridLines:this.sheetView.showGridLines,zoomScale:this.sheetView.zoomScale,zoomScaleNormal:this.sheetView.zoomScaleNormal},c=this.selections.topLeft,c&&c.activeCell&&(b.activeCell=c.activeCell),this.sheetView.style&&(b.style=this.sheetView.style)),!1;default:return!0}},reconcile:function(a,b){}});