/*! ExcelJS 28-04-2017 */
"use strict";function assign(a,b,c,d){var e=b[c];void 0!==e?a[c]=e:void 0!==d&&(a[c]=d)}function parseBool(a){switch(a){case"1":case"true":return!0;default:return!1}}function assignBool(a,b,c,d){var e=b[c];void 0!==e?a[c]=parseBool(e):void 0!==d&&(a[c]=d)}var _=require("../../../utils/under-dash"),utils=require("../../../utils/utils"),BaseXform=require("../base-xform"),DataValidationsXform=module.exports=function(){};utils.inherits(DataValidationsXform,BaseXform,{get tag(){return"dataValidations"},render:function(a,b){var c=b&&Object.keys(b).length;c&&(a.openNode("dataValidations",{count:c}),_.each(b,function(b,c){a.openNode("dataValidation"),"any"!==b.type&&(a.addAttribute("type",b.type),b.operator&&"list"!==b.type&&"between"!==b.operator&&a.addAttribute("operator",b.operator),b.allowBlank&&a.addAttribute("allowBlank","1")),b.showInputMessage&&a.addAttribute("showInputMessage","1"),b.promptTitle&&a.addAttribute("promptTitle",b.promptTitle),b.prompt&&a.addAttribute("prompt",b.prompt),b.showErrorMessage&&a.addAttribute("showErrorMessage","1"),b.errorStyle&&a.addAttribute("errorStyle",b.errorStyle),b.errorTitle&&a.addAttribute("errorTitle",b.errorTitle),b.error&&a.addAttribute("error",b.error),a.addAttribute("sqref",c),(b.formulae||[]).forEach(function(c,d){a.openNode("formula"+(d+1)),"date"===b.type?a.writeText(utils.dateToExcel(c)):a.writeText(c),a.closeNode()}),a.closeNode()}),a.closeNode())},parseOpen:function(a){switch(a.name){case"dataValidations":return this.model={},!0;case"dataValidation":this._address=a.attributes.sqref;var b=this._definedName=a.attributes.type?{type:a.attributes.type,formulae:[]}:{type:"any"};switch(a.attributes.type&&assignBool(b,a.attributes,"allowBlank"),assignBool(b,a.attributes,"showInputMessage"),assignBool(b,a.attributes,"showErrorMessage"),b.type){case"any":case"list":case"custom":break;default:assign(b,a.attributes,"operator","between")}return assign(b,a.attributes,"promptTitle"),assign(b,a.attributes,"prompt"),assign(b,a.attributes,"errorStyle"),assign(b,a.attributes,"errorTitle"),assign(b,a.attributes,"error"),!0;case"formula1":case"formula2":return this._formula=[],!0;default:return!1}},parseText:function(a){this._formula.push(a)},parseClose:function(a){switch(a){case"dataValidations":return!1;case"dataValidation":return this._definedName.formulae&&this._definedName.formulae.length||(delete this._definedName.formulae,delete this._definedName.operator),this.model[this._address]=this._definedName,!0;case"formula1":case"formula2":var b=this._formula.join("");switch(this._definedName.type){case"whole":case"textLength":b=parseInt(b,10);break;case"decimal":b=parseFloat(b);break;case"date":b=utils.excelToDate(parseFloat(b))}return this._definedName.formulae.push(b),!0;default:return!0}}});