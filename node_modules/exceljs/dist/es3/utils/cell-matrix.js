/*! ExcelJS 28-04-2017 */
"use strict";var _=require("./under-dash"),utils=require("./utils"),colCache=require("./col-cache"),CellMatrix=function(a){this.template=a,this.sheets={}};CellMatrix.prototype={addCell:function(a){this.addCellEx(colCache.decodeEx(a))},getCell:function(a){return this.findCellEx(colCache.decodeEx(a),!0)},findCell:function(a){return this.findCellEx(colCache.decodeEx(a),!1)},findCellAt:function(a,b,c){var d=this.sheets[a],e=d&&d[b];return e&&e[c]},addCellEx:function(a){if(a.top)for(var b=a.top;b<=a.bottom;b++)for(var c=a.left;c<=a.right;c++)this.getCellAt(a.sheetName,b,c);else this.findCellEx(a,!0)},getCellEx:function(a){return this.findCellEx(a,!0)},findCellEx:function(a,b){var c=this.findSheet(a,b),d=this.findSheetRow(c,a,b);return this.findRowCell(d,a,b)},getCellAt:function(a,b,c){var d=this.sheets[a]||(this.sheets[a]=[]),e=d[b]||(d[b]=[]);return e[c]||(e[c]={sheetName:a,address:colCache.n2l(c)+b,row:b,col:c})},removeCellEx:function(a){var b=this.findSheet(a);if(b){var c=this.findSheetRow(b,a);c&&delete c[a.col]}},forEach:function(a){_.each(this.sheets,function(b){b&&b.forEach(function(b){b&&b.forEach(function(b){b&&a(b)})})})},map:function(a){var b=[];return this.forEach(function(c){b.push(a(c))}),b},findSheet:function(a,b){var c=a.sheetName;return this.sheets[c]?this.sheets[c]:b?this.sheets[c]=[]:void 0},findSheetRow:function(a,b,c){var d=b.row;return a&&a[d]?a[d]:c?a[d]=[]:void 0},findRowCell:function(a,b,c){var d=b.col;return a&&a[d]?a[d]:c?a[d]=this.template?Object.assign(b,JSON.parse(JSON.stringify(this.template))):b:void 0}},module.exports=CellMatrix;